cmake_minimum_required(VERSION 3.9.0)

set(PACKAGE_NAME "dittorn")
project(PACKAGE_NAME)
set(CMAKE_VERBOSE_MAKEFILE ON)
set(CMAKE_CXX_STANDARD 17)

include_directories(
        ../cpp/include
        dittoffi/src
)

file(GLOB SOURCES "../cpp/src/*.cpp" "dittoffi/src/*.cpp")
add_library(
        ${PACKAGE_NAME}
        SHARED
        ${SOURCES}
        ./cpp-adapter.cpp
)

find_package(ReactAndroid REQUIRED CONFIG)
find_library(LOG_LIB log)
find_package(fbjni REQUIRED CONFIG)

add_library(dittoffi SHARED IMPORTED)
set_target_properties(dittoffi PROPERTIES IMPORTED_LOCATION "${CMAKE_SOURCE_DIR}/dittoffi/libs/${ANDROID_ABI}/libdittoffi.so")

if(ReactAndroid_VERSION_MINOR GREATER_EQUAL 76)
        target_link_libraries(${PACKAGE_NAME} ReactAndroid::reactnative)
else()
        target_link_libraries(${PACKAGE_NAME}
                ReactAndroid::turbomodulejsijni
                ReactAndroid::react_nativemodule_core
                android
        )
endif()

target_link_libraries(${PACKAGE_NAME}
        dittoffi
        ${LOG_LIB}
        ReactAndroid::jsi
        fbjni::fbjni
)
